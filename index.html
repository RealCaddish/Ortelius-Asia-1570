<!DOCTYPE html>
<html>

<head>
  <title>My map</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
    crossorigin="" />
  <style>
    body {
      margin: 0;
      padding: 0;
    }

    p img {
      float: left;
      padding: 0 12px 12px 0;
    }

    #map {
      position: absolute;
      width: 60%;
      top: 0;
      bottom: 0;
    }

    #info-panel {
      position: absolute;
      width: 37%;
      top: 0;
      bottom: 0;
      right: 0;
      background-color: #616195;
      padding: 12px 18px 3%;
    }

    #ui {
      padding: 8px 12px;
    }

    button {
      width: 20%;
    }

    #btn-back {
      margin-right: 12px;
    }
  </style>
</head>

<body>
  <div id="map"></div>
  <div id="info-panel">
    <h2>An Ortelius Map of Asia - An Example from the Dutch Goldan Age of Cartography </h2>
    <div id="ui">
      <button id="btn-back">
        << back</button><button id="btn-forward">forward >></button>
    </div>
    <div id="place-info">
      Intro text can be written here and then replaced when clicking on markers or navigating with back, forward UI.
    </div>

  </div>

  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
    integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
    crossorigin=""></script>
  <!-- make sure to import Leaflet-IIIF *after* the main Leaflet package -->
  <script src="https://cdn.rawgit.com/mejackreed/Leaflet-IIIF/v3.0.0/leaflet-iiif.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

  <script>
    // instantite Leaflet map
    const map = L.map("map", {
      center: [0, 0],
      crs: L.CRS.Simple,
      zoom: 0,
    });

    // request IIIF layer and add to map
    const chamizalLayer = new L.tileLayer.iiif(
      "https://collections.leventhalmap.org/search/commonwealth:st74cw485/info.json"
    ).addTo(map);

    // select the side panel div to insert info into later
    const placeInfo = $('#place-info');

    // select the UI elements and reference with variables
    const backButton = $('#btn-back');
    const forwardButton = $('#btn-forward');

    // use this to determine mouse position
    // can then use coords to create markers, etc.
    map.on('mousemove', (e) => {
      // console.log(e.latlng)
    })

    // here we'll create markers for key places in the story
    const lex = L.marker([-280, 511]).addTo(map);
    const frog = L.marker([-280, 258]).addTo(map);
    const halleysComet = L.marker([-156, 638]).addTo(map);

    // can use template strings for organizing text content
    const twainImg = '<img src="./images/twain.jpeg">';
    const twainLink = '<a href="">printing and typesetting</a>'

    // construct text string to be inserted into DOM
    const lexHtml = `<h3>Lexington is cool</h3><p>Lorem Ipsum is simply dummy ${twainImg} text of the  industry. Lorem Ipsum has been the industrys standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.</p>
        
        <p>It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.</p>`

    const frogHtml = `<h3>Frogs are cool</h3>There are many variations of passages of Lorem Ipsum available, but the majority have suffered alteration in some form, by injected humour, or randomised words which dont look even slightly believable. If you are going to use a passage of Lorem Ipsum, you need to be sure there isnt anything embarrassing hidden in the middle of text. All the Lorem Ipsum generators on the Internet tend to repeat predefined chunks as necessary, making this the first true generator on the Internet. It uses a dictionary of over 200 Latin words, combined with a handful of model sentence structures, to generate Lorem Ipsum which looks reasonable. The generated Lorem Ipsum is therefore always free from repetition, injected humour, or non-characteristic words etc.`

    const cometHtml = `<h3>Halley's Cometis rad</h3><p>So beautiful ...</p>`;

    // function to be called when both clicking on marker and
    // when using UI buttons to move fowward and back
    function triggerLex() {
      // replace exisiting HTML content in the side panel
      placeInfo.html(lexHtml);
      // fly the map to that location
      map.flyTo(lex.getLatLng(), 3);
    }

    function triggerFrog() {
      placeInfo.html(frogHtml);
      map.flyTo(frog.getLatLng(), 3);
    }

    function triggerComet() {
      placeInfo.html(cometHtml);
      map.flyTo(halleysComet.getLatLng(), 3);
    }

    // on marker click, trigger Lex event
    lex.on('click', () => {
      triggerLex();
    });

    frog.on('click', () => {
      triggerFrog();
    });

    // use a list to dictate order of story
    const story = ['lex', 'frog', 'comet'];

    // counter to keep track of where in story the user is
    let counter = 0;

    // object mapping the name of the places in the story
    // to the function to be triggered
    const storyMap = {
      lex: triggerLex,
      frog: triggerFrog,
      comet: triggerComet
    }

    // forward button increments counter and calls appropriate trigger function
    forwardButton.on('click', () => {
      console.log('before: counter: ', counter, 'object: ', story[counter]);
      if (counter < story.length) {
        storyMap[story[counter]]();
      }
      if (counter < story.length - 1) {
        counter++;
      }
      console.log('after: counter:', counter, 'object: ', story[counter]);
    });

    // backward button decreases value of counter and calls appropriate trigger function
    backButton.on('click', () => {
      console.log('before: counter: ', counter, 'object: ', story[counter]);
      if (counter > 0) {
        counter--;
        storyMap[story[counter]]();
      }
      console.log('after: counter: ', counter, 'object: ', story[counter]);
    });



  </script>
</body>

</html>